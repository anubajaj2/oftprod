sap.ui.define(["oft/fiori/controller/BaseController","sap/m/MessageBox","sap/m/MessageToast","oft/fiori/models/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/viz/ui5/format/ChartFormatter","sap/viz/ui5/api/env/Format","sap/m/Dialog","sap/m/DialogType"],function(e,t,r,a,o,s,i,n,l,p){"use strict";return e.extend("oft.fiori.controller.smsCenter",{formatter:a,onInit:function(){this.oRouter=sap.ui.core.UIComponent.getRouterFor(this);this.oRouter.attachRoutePatternMatched(this.herculis,this);var e=this.getModel("local").getProperty("/CurrentUser");if(e){var t=this.getModel("local").oData.AppUsers[e].UserName;this.getView().byId("idUser").setText(t)}},getUserId:function(e){return this.getModel("local").getData().CurrentUser},handleUploadPress:function(){var e=this.byId("fileUploader");if(!e.getValue()){r.show("Choose a file first");return}e.getAggregation("parameters")[0].setValue(this.getModel("local").getData().CurrentUser);var t={kind:"SMSCenter",type:this.getModel("local").getProperty("/smsCenter/type"),createdOn:this.getModel("local").getProperty("/smsCenter/CreatedOn"),createdBy:""};e.getAggregation("parameters")[1].setValue(JSON.stringify(t));e.upload()},handleUploadComplete:function(e){var t=e.getParameter("response");var a=e.getSource();if(t){var o="";debugger;if(JSON.parse(t.split('">')[1].replace("</pre>","")).error_code!==0){o=JSON.parse(t.split('">')[1].replace("</pre>","")).err_desc}else{o="Uploaded Successfully"}r.show(o)}},updateInq:function(){var e=this;$.post("/upload",{kind:"SMSCenter",type:this.getModel("local").getProperty("/smsCenter/type"),createdOn:this.getModel("local").getProperty("/smsCenter/CreatedOn"),createdBy:""}).done(function(e,t){sap.m.MessageBox.error("Done")}).fail(function(e,t,r){sap.m.MessageBox.error("Error in upload")})},passwords:"",onSendSMS:function(){var e=this},onBack:function(){sap.ui.getCore().byId("idApp").to("idView1")},herculis:function(e){if(e.getParameter("name")!=="smsCenter"){return}this.getView().getModel("local").setProperty("/newLead/date",this.formatter.getFormattedDate(0));var t=new Date;t.setHours(0,0,0,0);var r=new sap.ui.model.Sorter("CreatedOn",true);var a=this.getView().byId("idRecent");a.bindAggregation("items",{path:"/SMSTexts",template:new sap.m.DisplayListItem({label:"{phoneNo}",value:"{type} / {CreatedOn} / {blocked}"})})}})});